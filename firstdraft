明白了 ✅：

你希望移除所有“默认字段识别逻辑”，只使用用户手动指定的字段列表（例如 ['emplr_acct_cd', 'mbr_acct_cd']）作为 SELECT 和 WHERE (...) IN (...) 中使用的字段。

⸻

✅ 功能说明：

功能项	说明
❌ 默认字段识别	不再自动识别 employer 和 member
✅ 全部字段由用户传入	通过参数 selected_cols 明确指定
✅ 空值转为 NULL	对应字段空字符串会被转为 SQL 的 NULL
✅ 整行空值跳过	无数据的行会被自动忽略
✅ Excel 粘贴支持	多空格自动转为 Tab，兼容复制内容


⸻

✅ 最终代码如下：

import csv
import re
from io import StringIO

def generate_sql_query_custom_columns(table_name, input_text, selected_cols):
    """
    构建格式化 SQL 查询，仅使用手动指定字段作为 SELECT 和 WHERE 的依据

    参数:
    - table_name (str): 数据表名
    - input_text (str): 从Excel复制粘贴的表格文本（支持多空格）
    - selected_cols (list[str]): 用户指定字段名（必须是列中存在的）

    返回:
    - str: 格式化 SQL 查询语句
    """

    # 替换粘贴中的特殊空格并将多空格转换为 tab 分隔
    input_text = input_text.strip().replace('\xa0', ' ')
    input_text = '\n'.join([
        re.sub(r' {2,}', '\t', line.strip())
        for line in input_text.strip().splitlines()
    ])

    reader = csv.reader(StringIO(input_text), delimiter='\t')
    rows = list(reader)
    if not rows:
        return "-- No data found in input_text."

    all_columns = [col.strip() for col in rows[0]]
    data_rows = rows[1:]

    # 验证字段是否存在
    missing_cols = [col for col in selected_cols if col not in all_columns]
    if missing_cols:
        return f"-- Error: The following selected columns are not found in the data: {missing_cols}"

    selected_indices = [all_columns.index(col) for col in selected_cols]

    # 清洗有效行
    clean_rows = []
    for row in data_rows:
        if len(row) < len(all_columns):
            row += [''] * (len(all_columns) - len(row))
        row = row[:len(all_columns)]
        if all(cell.strip() == '' for cell in row):
            continue
        clean_rows.append([cell.strip() for cell in row])

    # 生成 WHERE 的元组值
    where_values = []
    for row in clean_rows:
        values = [
            'NULL' if row[idx] == '' else f"'{row[idx]}'"
            for idx in selected_indices
        ]
        where_values.append(f"    ({', '.join(values)})")

    select_clause = ",\n    ".join(selected_cols)
    where_clause = f"({', '.join(selected_cols)}) IN (\n{',\n'.join(where_values)}\n)"

    sql = f"""SELECT
    {select_clause}
FROM {table_name}
WHERE {where_clause};
"""
    return sql


⸻

✅ 使用示例：

selected_fields = ["emplr_acct_cd", "mbr_acct_cd"]  # 手动指定字段
sql = generate_sql_query_custom_columns("ra_rebate_details_account", input_text, selected_fields)
print(sql)


⸻

✅ 错误处理：

如果字段名拼错、字段不存在，返回错误提示：

-- Error: The following selected columns are not found in the data: ['xyz']


⸻

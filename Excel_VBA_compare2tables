def generate_vba_diff_highlighter(table_a_range, table_b_range):
    """
    Generates VBA code to highlight differences between two tables in Excel.
    
    Args:
        table_a_range (str): Range of Table A (e.g., "A252:AW269")
        table_b_range (str): Range of Table B (e.g., "A276:AW289")
    
    Returns:
        str: Complete VBA macro code
    """
    vba_code = f"""Sub HighlightDifferences()
    Dim ws As Worksheet
    Set ws = ActiveSheet ' Or specify sheet like ThisWorkbook.Sheets("Sheet2")
    
    ' Define table ranges
    Dim rngA As Range, rngB As Range
    Set rngA = ws.Range("{table_a_range}")
    Set rngB = ws.Range("{table_b_range}")
    
    ' Clear existing formatting
    rngB.Interior.Pattern = xlNone
    
    ' Comparison logic
    Dim cell As Range
    For Each cell In rngB.Columns(1).Cells ' Loop through employer_account_code column (A)
        If cell.Value <> "" Then
            ' Find matching row in Table A (A and I columns)
            Dim matchRow As Long
            matchRow = 0
            For i = 1 To rngA.Rows.Count
                If rngA.Cells(i, 1).Value = cell.Value And _
                   rngA.Cells(i, 9).Value = cell.Offset(0, 8).Value Then ' Column I is 9
                    matchRow = i
                    Exit For
                End If
            Next i
            
            ' If match found, compare all columns
            If matchRow > 0 Then
                For col = 1 To rngB.Columns.Count
                    If cell.Offset(0, col - 1).Value <> rngA.Cells(matchRow, col).Value Then
                        cell.Offset(0, col - 1).Interior.Color = RGB(255, 255, 0) ' Yellow
                    End If
                Next col
            End If
        End If
    Next cell
    
    MsgBox "Difference highlighting completed!", vbInformation
End Sub
"""
    return vba_code

# Example usage:
table_a = "A253:AW269"  # First data row is 253
table_b = "A277:AW289"  # First data row is 277
vba_script = generate_vba_diff_highlighter(table_a, table_b)
print(vba_script)


## Example：
Sub HighlightDifferences_Sheet2()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("Sheet2") ' 明确指定Sheet2
    
    ' 定义表A（主表）和表B（需标黄表）范围
    Dim rngA As Range, rngB As Range
    Set rngA = ws.Range("A253:AW269") ' 表A范围（根据实际调整）
    Set rngB = ws.Range("A277:AW289") ' 表B范围（根据实际调整）
    
    ' 清除旧格式
    rngB.Interior.Pattern = xlNone
    
    ' 比较逻辑
    Dim cell As Range
    For Each cell In rngB.Columns(1).Cells ' 遍历表B的employer_account_code列(A列)
        If cell.Value <> "" Then
            ' 在表A中查找匹配行（A列和I列双条件）
            Dim matchRow As Long
            matchRow = 0
            For i = 1 To rngA.Rows.Count
                If rngA.Cells(i, 1).Value = cell.Value And _
                   rngA.Cells(i, 9).Value = cell.Offset(0, 8).Value Then ' I列是第9列
                    matchRow = i
                    Exit For
                End If
            Next i
            
            ' 如果找到匹配行，逐列比较
            If matchRow > 0 Then
                For col = 1 To rngB.Columns.Count
                    If cell.Offset(0, col - 1).Value <> rngA.Cells(matchRow, col).Value Then
                        cell.Offset(0, col - 1).Interior.Color = RGB(255, 255, 0) ' 黄色
                    End If
                Next col
            End If
        End If
    Next cell
    
    MsgBox "差异标记完成！", vbInformation
End Sub

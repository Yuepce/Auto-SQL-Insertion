import re
import pandas as pd

def parse_test_cases_to_excel(text: str, output_path: str):
    """
    将结构化的测试用例文本内容解析为DataFrame并导出为Excel。
    
    参数：
        text: 包含测试用例的文本内容
        output_path: 输出Excel路径，如 '/path/to/output.xlsx'
    """
    # 使用正则表达式提取Test Case内容
    pattern = r"Test Case ID:\s*(GOV_Term_[PN]\d+)\s*" \
              r"Description:\s*(.*?)\s*" \
              r"Test Condition:\s*(.*?)" \
              r"Expected Result:\s*(.*?)(?=\nTest Case ID:|$)"
    
    matches = re.findall(pattern, text, flags=re.DOTALL)

    records = []
    for case_id, desc, cond, expected in matches:
        test_type = "Positive" if "_P" in case_id else "Negative"
        record = {
            "Test Case ID": case_id.strip(),
            "Test Activity Ref #": "",
            "Description": f"[{test_type}] {desc.strip()}",
            "Test Condition / Input": cond.strip().replace("\n", " "),
            "Expected Result / Output": expected.strip().replace("\n", " "),
            "Actual Result": "",
            "Pass/Fail": "",
            "Comments": ""
        }
        records.append(record)

    # 写入 Excel
    df = pd.DataFrame(records)
    df.to_excel(output_path, index=False)
    print(f"✅ 成功生成Excel文件：{output_path}")

# 示例调用
if __name__ == "__main__":
    # 用你的实际路径替换这里
    input_file = "test_cases_input.txt"
    output_file = "HKSAR_Term_Vesting_TestCases.xlsx"

    with open(input_file, "r", encoding="utf-8") as f:
        content = f.read()

    parse_test_cases_to_excel(content, output_file)
